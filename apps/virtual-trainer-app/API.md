# Virtual Trainer API Documentation

## –û–±–∑–æ—Ä

Virtual Trainer –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å LLM-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º, –≤–∫–ª—é—á–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–∞–º–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

**Base URL**: `http://localhost:8000/api/v1`

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è JWT —Ç–æ–∫–µ–Ω—ã.

```bash
# –ë—É–¥—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç
Authorization: Bearer <jwt_token>
```

## LLM –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ß–∞—Ç —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º —Ç—Ä–µ–Ω–µ—Ä–æ–º

**POST** `/llm/chat/send`

–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É —Ç—Ä–µ–Ω–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.

#### –ó–∞–ø—Ä–æ—Å

```json
{
  "user_id": "string",
  "session_id": "string", 
  "message": "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è?",
  "attachments": ["url1", "url2"]
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "response_text": "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è - —ç—Ç–æ –±–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ...",
  "session_id": "string",
  "timestamp": "2024-01-01T12:00:00Z",
  "metadata": {
    "tokens_used": 150,
    "model": "gpt-4",
    "latency_ms": 1200
  }
}
```

#### –ü—Ä–∏–º–µ—Ä

```bash
curl -X POST "http://localhost:8000/api/v1/llm/chat/send" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "session_id": "session456",
    "message": "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è?"
  }'
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

**POST** `/llm/program/create`

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞.

#### –ó–∞–ø—Ä–æ—Å

```json
{
  "user_id": "string",
  "goal": "—Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞",
  "level": "–Ω–∞—á–∞–ª—å–Ω—ã–π",
  "equipment": ["–≥–∞–Ω—Ç–µ–ª–∏", "—Ç—É—Ä–Ω–∏–∫"],
  "sessions_per_week": 3,
  "limitations": ["–±–æ–ª—å–Ω–∞—è —Å–ø–∏–Ω–∞"]
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "program_id": "uuid",
  "program_structure": {
    "program_id": "uuid",
    "weeks": [
      {
        "week_number": 1,
        "days": [
          {
            "day_of_week": "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
            "workout_type": "—Å–∏–ª–æ–≤–∞—è",
            "exercises": [
              {
                "name": "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏",
                "sets": 3,
                "reps": 12,
                "weight": 8,
                "notes": "–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–µ—Ö–Ω–∏–∫–æ–π"
              }
            ]
          }
        ]
      }
    ],
    "generated_at": "2024-01-01T12:00:00Z"
  },
  "generated_at": "2024-01-01T12:00:00Z",
  "metadata": {
    "tokens_used": 800,
    "model": "gpt-4",
    "latency_ms": 2500
  }
}
```

### 3. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã

**POST** `/llm/program/adjust`

–ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ.

#### –ó–∞–ø—Ä–æ—Å

```json
{
  "user_id": "string",
  "program_id": "uuid",
  "feedback": "–°–ª–∏—à–∫–æ–º —Ç—è–∂–µ–ª–æ, –Ω–µ –º–æ–≥—É –¥–µ–ª–∞—Ç—å 12 –ø–æ–≤—Ç–æ—Ä–æ–≤",
  "progress_data": {
    "day": "2024-01-01",
    "exercise_results": [
      {
        "exercise": "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏",
        "sets": 3,
        "reps": 8,
        "weight": 8
      }
    ]
  }
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "program_id": "uuid",
  "program_structure": {
    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  },
  "generated_at": "2024-01-01T12:00:00Z",
  "metadata": {
    "tokens_used": 600,
    "model": "gpt-4",
    "latency_ms": 2000
  }
}
```

### 4. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**POST** `/llm/progress/analyze`

–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.

#### –ó–∞–ø—Ä–æ—Å

```json
{
  "user_id": "string",
  "date_from": "2024-01-01",
  "date_to": "2024-01-31"
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "report": {
    "summary": "–ó–∞ —è–Ω–≤–∞—Ä—å –≤—ã —Å–Ω–∏–∑–∏–ª–∏ –≤–µ—Å –Ω–∞ 3 –∫–≥ –∏ —É–ª—É—á—à–∏–ª–∏ —Å–∏–ª–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏",
    "bottlenecks": [
      "–ó–∞—Å—Ç–æ–π –≤ —Å—Ç–∞–Ω–æ–≤–æ–π —Ç—è–≥–µ –Ω–∞ 3-4 –Ω–µ–¥–µ–ª–µ",
      "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–º –∫–∞—Ä–¥–∏–æ"
    ],
    "recommendations": [
      "–î–æ–±–∞–≤–∏—Ç—å 2 –∫–∞—Ä–¥–∏–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ 20 –º–∏–Ω",
      "–°–Ω–∏–∑–∏—Ç—å –≤–µ—Å –≤ —Å—Ç–∞–Ω–æ–≤–æ–π –Ω–∞ 10% –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å—É–ø–µ—Ä—Å–µ—Ç—ã"
    ],
    "achievements": [
      "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∂–∏–º–∞ –ª–µ–∂–∞ –Ω–∞ 15%",
      "–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞ –Ω–∞ 3 –∫–≥"
    ],
    "next_goals": [
      "–î–æ—Å—Ç–∏—á—å 100 –∫–≥ –≤ —Å—Ç–∞–Ω–æ–≤–æ–π —Ç—è–≥–µ",
      "–°–Ω–∏–∑–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞ –¥–æ 15%"
    ]
  },
  "generated_at": "2024-01-01T12:00:00Z",
  "metadata": {
    "tokens_used": 400,
    "model": "gpt-4",
    "latency_ms": 1800
  }
}
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**POST** `/llm/notifications/create`

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

#### –ó–∞–ø—Ä–æ—Å

```json
{
  "user_id": "string",
  "type": "workout_reminder",
  "context": {
    "name": "–ò–≤–∞–Ω",
    "next_workout": "19:00",
    "workout_type": "—Å–∏–ª–æ–≤–∞—è",
    "days_since_last": 3
  }
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "notification_id": "uuid",
  "message": "–ü—Ä–∏–≤–µ—Ç, –ò–≤–∞–Ω! –°–µ–≥–æ–¥–Ω—è –≤ 19:00 —É —Ç–µ–±—è —Å–∏–ª–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞. –ì–æ—Ç–æ–≤ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç? üí™",
  "scheduled_at": "2024-01-01T17:00:00Z",
  "metadata": {
    "tokens_used": 50,
    "model": "gpt-4",
    "latency_ms": 800
  }
}
```

#### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- `workout_reminder` - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ
- `payment_reminder` - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ
- `motivational` - –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `progress_report` - –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç

### 6. –°—Ç–∞—Ç—É—Å LLM —Å–µ—Ä–≤–∏—Å–∞

**GET** `/llm/status`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ LLM —Å–µ—Ä–≤–∏—Å–∞.

#### –û—Ç–≤–µ—Ç

```json
{
  "status": "operational",
  "model": "gpt-4",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π —á–∞—Ç–∞

**GET** `/chat/sessions?user_id=string`

```json
[
  {
    "id": "session-1",
    "name": "–ß–∞—Ç —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º —Ç—Ä–µ–Ω–µ—Ä–æ–º",
    "created_at": "2024-01-01T12:00:00Z",
    "is_active": true
  }
]
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

**GET** `/chat/sessions/{session_id}/messages`

```json
[
  {
    "id": "msg-1",
    "sender_role": "client",
    "message_text": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
    "created_at": "2024-01-01T12:00:00Z"
  }
]
```

### –°–±—Ä–æ—Å —Å–µ—Å—Å–∏–∏

**POST** `/chat/sessions/{session_id}/reset`

```json
{
  "message": "–°–µ—Å—Å–∏—è —Å–±—Ä–æ—à–µ–Ω–∞"
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏

### –°–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/programs/?user_id=string`

```json
[
  {
    "id": "program-1",
    "name": "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞",
    "description": "4-–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞",
    "created_at": "2024-01-01T12:00:00Z",
    "is_active": true
  }
]
```

### –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã

**GET** `/programs/{program_id}`

```json
{
  "id": "program-1",
  "name": "–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫",
  "structure": {
    "weeks": []
  },
  "created_at": "2024-01-01T12:00:00Z"
}
```

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 401 | –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω |
| 403 | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω |
| 404 | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 422 | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| 429 | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
| 503 | –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (LLM) |

### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏

```json
{
  "detail": "–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º",
  "error_code": "VALIDATION_ERROR"
}
```

## Rate Limiting

- **–õ–∏–º–∏—Ç**: 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- **LLM –∑–∞–ø—Ä–æ—Å—ã**: 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞**:
  - `X-RateLimit-Limit`: –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
  - `X-RateLimit-Remaining`: –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã
  - `X-RateLimit-Reset`: –í—Ä–µ–º—è —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Python

```python
import requests

# –ß–∞—Ç —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º —Ç—Ä–µ–Ω–µ—Ä–æ–º
response = requests.post(
    "http://localhost:8000/api/v1/llm/chat/send",
    json={
        "user_id": "user123",
        "session_id": "session456", 
        "message": "–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è?"
    }
)

data = response.json()
print(data["response_text"])
```

### JavaScript

```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
const response = await fetch('http://localhost:8000/api/v1/llm/program/create', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    user_id: 'user123',
    goal: '—Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞',
    level: '–Ω–∞—á–∞–ª—å–Ω—ã–π',
    sessions_per_week: 3,
    equipment: ['–≥–∞–Ω—Ç–µ–ª–∏']
  })
});

const data = await response.json();
console.log(data.program_structure);
```

### cURL

```bash
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
curl -X POST "http://localhost:8000/api/v1/llm/progress/analyze" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "date_from": "2024-01-01",
    "date_to": "2024-01-31"
  }'
```

## Webhook –¥–ª—è Telegram

**POST** `/webhook`

–≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Telegram Bot API.

```json
{
  "update_id": 123456789,
  "message": {
    "message_id": 1,
    "from": {
      "id": 123456789,
      "first_name": "–ò–≤–∞–Ω"
    },
    "chat": {
      "id": 123456789,
      "type": "private"
    },
    "text": "–ü—Ä–∏–≤–µ—Ç!"
  }
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Health Check**: `GET /health`
- **Metrics**: `GET /metrics` (Prometheus)
- **OpenAPI**: `GET /docs`

## –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ URL: `/api/v1/`

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **v1.0.0** 